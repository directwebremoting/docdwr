<!DOCTYPE html>
<html>
<head>
  <title>Image and Binary File Conversion</title>
  <meta name='alias' content='/dwr/server/dwrxml/converters/file.html'>
  <meta name='navTitle' content='Images and Binary Files'>
  <link rel="stylesheet" type="text/css" href="../../../../../media/styles.css">
</head>
<body>

<h1>Image and Binary File Conversion</h1>

<p>DWR 3.0 features a new FileConverter that handles the following binary files:</p>

<ul>
<li>Images (any child of java.awt.BufferedImage)</li>
<li>InputStreams (any child of java.io.InputStream)</li>
<li>FileTransfer objects (org.directwebremoting.io.FileTransfer)</li>
</ul>

<p>In order for upload to work, <a href="http://commons.apache.org/fileupload/">commons-fileupload</a> and <a href="http://commons.apache.org/io/">commons-io</a> are required on the classpath. See the <a href="http://commons.apache.org/fileupload/dependencies.html">commons-upload dependency chart</a> for more information. DWR will give you the error message: "file uploads not supported" if this JAR file is missing.</p>

<h1>Specifying a max upload size</h1>
If you would like to limit the maximum allowed size of file uploads we provide the "fileUploadMaxBytes" init-param on the DWR servlet.  This parameter can be specified as follows:
     <pre>
     &lt;init-param&gt;
      &lt;param-name>fileUploadMaxBytes&lt;/param-name&gt;
      &lt;param-value>5000&lt;/param-value&gt;
     &lt;/init-param&gt;</pre>
<h1>Plugging in a custom Upload implementation</h1>
The FileUpload implementation used by DWR is also <a href="../../servlet/plugin.html">pluggable</a>.  If you would like to write your own implementation simply implement org.directwebremoting.dwrp.FileUpload and use <a href="../../servlet/plugin.html">DWR's plug-in architecture</a> to specify the implementation via an init-param on the DWR servlet.
  <pre>
    &lt;init-param&gt;
     &lt;param-name>org.directwebremoting.dwrp.FileUpload&lt;/param-name&gt;
     &lt;param-value>your.package.YourFileUploadImpl&lt;/param-value&gt;
    &lt;/init-param&gt;</pre>
<h1>Examples in the DWR.war</h1>
<p>The DWR war file contains an example of generating PDF files, as well as uploading and downloading images. Full source and explanations are included with these examples.</p>
<h1>A note about your environment</h1>
<p>It is important to note that servers running in production modes may not have access to the java.awt classes - making the use of DWR's upload feature limited (cannot upload images).  An example of this is Tomcat running in server mode:
<pre>
JAVA_OPTS="-server ... "
</pre>
<p>If Tomcat is configured to run with the preceding JAVA_OPTS uploading an image with DWR will fail with a marshalling error (as the AWT classes are not available).</p>
<p>The only way we have found to resolve this is by not running Tomcat in server mode (it defaults to client mode, so unless you specify -server everything should run smoothly).</p>
<p>Other servers may have similar problems and if you are getting generic marshalling exceptions this is something to look for.  If you do find this problem please consult your server's documentation.</p>

</p>
</body>
</html>
